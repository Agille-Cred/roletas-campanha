<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ROLETA DOURADA</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="main-container">
    <div class="navbar">
      <div class="nav-links">
        <a href="index.html" class="active">Roleta Dourada</a>
        <a href="roleta_premiada.html">Roleta Premiada</a>
      </div>
      <div class="nav-controls">
        <button id="spinBtn"><b>Girar</b> (ESPAÇO)</button>
        <button id="resetBtn">Reset</button>
        <button id="fsBtn">Tela cheia (F)</button>
        <button id="editPrizesBtn">Editar Prêmios</button>
      </div>
    </div>

    <div class="wrap">
      <div class="stage">
        <div class="hint" id="hint">Clique em <b>Girar</b> ou pressione <b>ESPAÇO</b></div>
        <canvas id="wheel" width="1180" height="1180" aria-label="Roleta"></canvas>
        <div class="pointer"></div>
        <div id="overlay" class="overlay" role="dialog" aria-live="polite">
          <div class="result-card">
            <small>Resultado:</small>
            <h2 id="resultText">—</h2>
            <button id="closeBtn">Fechar</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="prizeModal" class="modal">
    <div class="modal-content">
      <span class="close-button">&times;</span>
      <h2>Editar Prêmios</h2>
      <p>Digite um prêmio por linha. As linhas em branco serão ignoradas.</p>
      <textarea id="prizeInput" rows="10"></textarea>
      <div class="modal-actions">
        <button id="cancelPrizesBtn">Cancelar</button>
        <button id="savePrizesBtn">Salvar Alterações</button>
      </div>
    </div>
  </div>
  <audio id="somVitoria" src="vitoria.mp3" preload="auto"></audio>

<script>

/* =========================
   CONFIGURAÇÃO
========================= */
const localStorageKey = 'prizes_dourada'; 
const PRIZES = [
  ...Array(5).fill("R$ 50"),
  ...Array(4).fill("R$ 70"),
  ...Array(3).fill("R$ 90"),
  ...Array(2).fill("R$ 100"),

];
// embaralha
for (let i = PRIZES.length - 1; i > 0; i--) {
  const j = Math.floor(Math.random() * (i + 1));
  [PRIZES[i], PRIZES[j]] = [PRIZES[j], PRIZES[i]];
}
const LOGO_URL = null; 
const OMEGA_RANGE = [10, 22];
const DECEL_RANGE = [2.2, 3.8];
const NO_IMMEDIATE_REPEAT = true;

/* =========================
   VARS & CANVAS
========================= */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const overlay = document.getElementById('overlay');
const resultText = document.getElementById('resultText');
const spinBtn = document.getElementById('spinBtn');
const resetBtn = document.getElementById('resetBtn');
const fsBtn = document.getElementById('fsBtn');
const hint = document.getElementById('hint');
const somVitoria = document.getElementById('somVitoria');
const closeBtn = document.getElementById('closeBtn');
let W = canvas.width, H = canvas.height;
let cx = W/2, cy = H/2;
let R = Math.min(W,H)/2 - 46;
document.querySelector('.pointer').style.setProperty('--r', `${R}px`);
let angle = 0, omega = 0, decel = 0, spinning = false;
let lastIdx = null, lastWin = null;
let particles = [], bursts = [], shockwaves = [];
let lightPhase = 0, flashAlpha = 0;

/* =========================
      ÁUDIO 
========================= */
let audioCtx = null;
function ensureAudio(){ if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function beep(freq=2500, ms=50, gain=0.05){
  if (!audioCtx) return;
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=gain;
  o.connect(g).connect(audioCtx.destination);
  const t=audioCtx.currentTime; o.start(t); o.stop(t+ms/1000);
}
function playVictoryCheer(){
  if (!audioCtx) return;
  const now = audioCtx.currentTime;
  const master = audioCtx.createGain(); master.gain.value = 1.0;
  const comp = audioCtx.createDynamicsCompressor();
  comp.threshold.value=-16; comp.knee.value=24; comp.ratio.value=10;
  comp.attack.value=0.002; comp.release.value=0.18;
  const outGain = audioCtx.createGain(); outGain.gain.value = 0.95;
  master.connect(comp).connect(outGain).connect(audioCtx.destination);
}


/* =========================
   CONFETE & EFEITOS 
========================= */
class Confetti{
  constructor(x,y){this.x=x+(Math.random()*60-30);this.y=y+(Math.random()*40-20);
    this.vx=(Math.random()*700-350);this.vy=-(Math.random()*800+350);
    this.size=3+Math.random()*5;this.life=0;this.max=1.9+Math.random()*1.3;
    const hue = Math.random()*360;
    const saturation = 40 + Math.random()*30;
    const lightness = 70 + Math.random()*20;
    this.color=`hsl(${hue},${saturation}%,${lightness}%)`}
  update(dt){this.life+=dt;this.vy+=1200*dt;this.x+=this.vx*dt;this.y+=this.vy*dt}
  draw(ctx){if(this.life<this.max){ctx.fillStyle=this.color;ctx.fillRect(this.x,this.y,this.size,this.size)}}
}
class Burst{
  constructor(x,y,color){this.x=x;this.y=y;this.c=color;this.life=0;this.max=.7;
    this.parts=Array.from({length:36},(_,i)=>({ang:i*(Math.PI*2/36),spd:280+Math.random()*240,r:2+Math.random()*3}))}
  update(dt){this.life+=dt}
  draw(ctx){const k=1-this.life/this.max;ctx.save();ctx.globalCompositeOperation='lighter';
    for(const p of this.parts){const d=p.spd*this.life;const x=this.x+Math.cos(p.ang)*d,y=this.y+Math.sin(p.ang)*d;
      ctx.fillStyle=this.c;ctx.shadowBlur=16;ctx.shadowColor=this.c;ctx.beginPath();ctx.arc(x,y,p.r*k,0,Math.PI*2);ctx.fill()}
    ctx.restore()}
}

/* =========================
   ROLETA
========================= */
const off = document.createElement('canvas'); off.width=W; off.height=H; const offctx=off.getContext('2d');
function fitFontSize(ctx,text,maxWidth,maxSize,minSize=14){let s=maxSize;while(s>minSize){ctx.font=`900 ${s}px system-ui,Segoe UI,Roboto`;if(ctx.measureText(text).width<=maxWidth)break;s--}return Math.max(s,minSize)}
function drawBase(){
  offctx.clearRect(0,0,W,H);
  const n=PRIZES.length, seg=(Math.PI*2)/n;
  const goldColors = ['#FAD02E', '#F3B518'];
  const separatorColor = '#AB6400';
  for(let i=0;i<n;i++){
    const a0=i*seg,a1=(i+1)*seg;
    offctx.beginPath();offctx.moveTo(cx,cy);offctx.arc(cx,cy,R,a0,a1);offctx.closePath();
    offctx.fillStyle=goldColors[i % 2];
    offctx.fill();
  }
  const separatorHighlight = '#FFD700';
  for(let i=0; i<n; i++){
    const a0 = i * seg;
    offctx.beginPath();
    offctx.moveTo(cx,cy);
    offctx.lineTo(cx + R * Math.cos(a0 + 0.005), cy + R * Math.sin(a0 + 0.005));
    offctx.strokeStyle = separatorColor;
    offctx.lineWidth = 8;
    offctx.stroke();
    offctx.beginPath();
    offctx.moveTo(cx,cy);
    offctx.lineTo(cx + R * Math.cos(a0), cy + R * Math.sin(a0));
    offctx.strokeStyle = separatorHighlight;
    offctx.lineWidth = 4;
    offctx.stroke();
  }
  const rimTotalWidth = 44;
  const outerArcWidth = 10;
  const innerArcWidth = 6;
  offctx.beginPath();
  offctx.arc(cx, cy, R + rimTotalWidth / 2, 0, Math.PI * 2);
  offctx.strokeStyle = '#000000';
  offctx.lineWidth = rimTotalWidth;
  offctx.stroke();
  const gradOuter = offctx.createRadialGradient(cx, cy, R, cx, cy, R + rimTotalWidth);
  gradOuter.addColorStop(0, '#A46D07');
  gradOuter.addColorStop(1, '#FDE051');
  offctx.beginPath();
  offctx.arc(cx, cy, R + rimTotalWidth - (outerArcWidth / 2), 0, Math.PI * 2);
  offctx.strokeStyle = gradOuter;
  offctx.lineWidth = outerArcWidth;
  offctx.stroke();
  const numBulbs = 24;
  const bulbTrackRadius = R + (rimTotalWidth / 2);
  const bulbSize = 10;
  for (let i = 0; i < numBulbs; i++) {
    const angle = i * (Math.PI * 2 / numBulbs);
    const x = cx + bulbTrackRadius * Math.cos(angle);
    const y = cy + bulbTrackRadius * Math.sin(angle);
    offctx.save();
    offctx.shadowColor = '#FFFF00';
    offctx.shadowBlur = 15;
    offctx.beginPath();
    offctx.arc(x, y, bulbSize, 0, Math.PI * 2);
    offctx.fillStyle = '#FFFFFF';
    offctx.fill();
    offctx.restore();
  }
  const gradInner = offctx.createRadialGradient(cx, cy, R - innerArcWidth, cx, cy, R + innerArcWidth);
  gradInner.addColorStop(0, '#A46D07');
  gradInner.addColorStop(1, '#FDE051');
  offctx.beginPath();
  offctx.arc(cx, cy, R + (innerArcWidth/2), 0, Math.PI * 2);
  offctx.strokeStyle = gradInner;
  offctx.lineWidth = innerArcWidth;
  offctx.stroke();
  for(let i=0;i<n;i++){
    const mid=i*seg+seg/2;
    const textRadius = R * 0.75;
    const maxWidth = seg * textRadius * 0.8;
    const fontSize = fitFontSize(offctx, PRIZES[i], maxWidth, Math.round(R*0.13), 20);
    const tx=cx+textRadius*Math.cos(mid);
    const ty=cy+textRadius*Math.sin(mid);
    offctx.save();
    offctx.translate(tx,ty);
    offctx.rotate(mid);
    offctx.textAlign='center';
    offctx.textBaseline='middle';
    offctx.font=`900 ${fontSize}px system-ui,Segoe UI,Roboto`;
    offctx.fillStyle='#FFFFFF';
    offctx.fillText(PRIZES[i],0,0);
    offctx.restore();
  }
  const hubR=R*0.30;
  offctx.beginPath(); offctx.arc(cx,cy,hubR+3,0,Math.PI*2); offctx.fillStyle='#000000'; offctx.fill();
  offctx.beginPath(); offctx.arc(cx,cy,hubR,0,Math.PI*2); offctx.fillStyle='#000000'; offctx.fill();
  offctx.beginPath(); offctx.arc(cx,cy,hubR,0,Math.PI*2); offctx.strokeStyle='#FAD02E'; offctx.lineWidth=5; offctx.stroke();
  offctx.fillStyle = '#FFFFFF';
  offctx.textAlign = 'center';
  offctx.textBaseline = 'middle';
  offctx.font = `700 ${hubR*0.25}px system-ui, sans-serif`;
  offctx.fillText('ROLETA', cx, cy - hubR * 0.25);
  offctx.fillText('DOURADA', cx, cy + hubR * 0.25);
}
drawBase();

/* =========================
   LÓGICA DO JOGO
========================= */
function indexAtPointer(aRad,n){const seg=(Math.PI*2)/n;let th=(-Math.PI/2 - aRad)%(Math.PI*2);if(th<0)th+=Math.PI*2;return Math.floor(th/seg)}
function spin(){
  if(spinning) return; ensureAudio(); audioCtx.resume?.();
  overlay.classList.remove('show'); hint.style.display='none';
  omega=randBetween(...OMEGA_RANGE); decel=randBetween(...DECEL_RANGE);
  if(NO_IMMEDIATE_REPEAT && lastWin!==null){
    let tries=0; while(tries<20){
      const pred=indexAtPointer(angle+(omega*omega)/(2*decel),PRIZES.length);
      if(pred!==lastWin) break; omega=randBetween(...OMEGA_RANGE); decel=randBetween(...DECEL_RANGE); tries++;
    }
  }
  spinning=true;
}
function resetAll(){particles.length=0;bursts.length=0;overlay.classList.remove('show');hint.style.display=''}

/* =========================
   ANIMAÇÃO
========================= */
let prev=performance.now();
function frame(ts){
  const dt=Math.min(0.033,(ts-prev)/1000); prev=ts;
  lightPhase += dt*3.2;
  ctx.fillStyle='#fdfaf6'; ctx.fillRect(0,0,W,H);
  if(spinning){
    angle += omega*dt; omega -= decel*dt;
    if(omega<=0){
      omega=0; spinning=false;
      const idx=indexAtPointer(angle,PRIZES.length), prize=PRIZES[idx]; lastWin=idx;
      resultText.textContent=`Ganhou: ${prize}`;
      overlay.classList.add('show');
      if (somVitoria) { somVitoria.play(); }
      flashAlpha=240;
      for(let i=0;i<380;i++) particles.push(new Confetti(cx, cy-R*0.2));
      bursts.push(new Burst(cx, cy, 'rgba(255,220,120,0.95)'));
    }
    const idxNow=indexAtPointer(angle,PRIZES.length);
    if(lastIdx===null) lastIdx=idxNow;
    if(idxNow!==lastIdx){ lastIdx=idxNow; beep(1600+Math.min(1200,omega*70),30,0.1); }
  }
  ctx.save();ctx.translate(cx,cy);ctx.rotate(angle);ctx.drawImage(off,-cx,-cy);ctx.restore();
  if(flashAlpha>0){
    const g=ctx.createLinearGradient(0,0,0,H);
    g.addColorStop(0,`rgba(255,255,220,${flashAlpha/255*.4})`);
    g.addColorStop(1,'rgba(255,255,220,0)');
    ctx.fillStyle=g; ctx.fillRect(0,0,W,H);
    flashAlpha=Math.max(0,flashAlpha-700*dt);
  }
  particles.forEach(p=>p.update(dt)); particles=particles.filter(p=>p.life<p.max); particles.forEach(p=>p.draw(ctx));
  bursts.forEach(b=>b.update(dt)); bursts=bursts.filter(b=>b.life<b.max); bursts.forEach(b=>b.draw(ctx));
  requestAnimationFrame(frame);
}
requestAnimationFrame(frame);

/* =========================
   UTILS & EVENTOS
========================= */
function randBetween(a,b){return a + Math.random()*(b-a)}
spinBtn.addEventListener('click', () => { ensureAudio(); audioCtx.resume?.(); spin(); });
resetBtn.addEventListener('click', () => resetAll());
window.addEventListener('keydown', (e) => {
  if (e.code === 'Space') {
    if (prizeModal.style.display === 'block') return;

    e.preventDefault();
    ensureAudio();
    audioCtx.resume?.();
    spin();
  }
  if (e.key.toLowerCase() === 'f') {
    toggleFullscreen();
  }
});
fsBtn.addEventListener('click', toggleFullscreen);
function toggleFullscreen(){
  const doc=document, el=doc.documentElement;
  if(!doc.fullscreenElement) el.requestFullscreen?.({navigationUI:"hide"}) || el.webkitRequestFullscreen?.();
  else doc.exitFullscreen?.() || doc.webkitExitFullscreen?.();
}
closeBtn.addEventListener('click', () => overlay.classList.remove('show'));
function resizeCanvas(){
  const rect=document.querySelector('.stage').getBoundingClientRect();
  const size=Math.min(rect.width, rect.height) - 40;
  const dpr=Math.min(2, window.devicePixelRatio || 1);
  canvas.width=Math.max(680, size)*dpr;
  canvas.height=Math.max(680, size)*dpr;
  canvas.style.width=canvas.width/dpr+'px';
  canvas.style.height=canvas.height/dpr+'px';
  W=canvas.width; H=canvas.height; cx=W/2; cy=H/2; R=Math.min(W,H)/2 - 46*dpr;
  document.querySelector('.pointer').style.setProperty('--r', `${R/dpr}px`);
  off.width=W; off.height=H; drawBase();
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function openPrizeEditor() {
  prizeInput.value = PRIZES.join('\n');
  prizeModal.style.display = 'block';
}

function closePrizeEditor() {
  prizeModal.style.display = 'none';
}

function savePrizes() {
  const newPrizes = prizeInput.value
    .split('\n')          
    .map(p => p.trim()) 
    .filter(p => p);     

  if (newPrizes.length > 0) {
    PRIZES.length = 0;
    PRIZES.push(...newPrizes);

    localStorage.setItem(localStorageKey, JSON.stringify(newPrizes));

    drawBase();

    alert('Prêmios salvos com sucesso!');
    closePrizeEditor();
  } else {
    alert('Por favor, adicione pelo menos um prêmio.');
  }
}

editPrizesBtn.addEventListener('click', openPrizeEditor);
closeBtn.addEventListener('click', closePrizeEditor);
cancelPrizesBtn.addEventListener('click', closePrizeEditor);
savePrizesBtn.addEventListener('click', savePrizes);

window.addEventListener('click', (event) => {
  if (event.target == prizeModal) {
    closePrizeEditor();
  }
});
</script>
</body>
</html>